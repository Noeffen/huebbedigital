<!DOCTYPE html>
<html lang="de">
<head><meta charset="UTF-8"><title>Meldungen</title><link rel="stylesheet" href="admin-styles.css"></head>
<body>
<header class="admin-header"><div class="container header-content"><a href="dashboard.html" class="logo">Fairway<span class="logo-green">Service</span></a><div class="user-info"><span id="userEmail"></span><button class="btn-logout" id="logoutBtn">Abmelden</button></div></div></header>
<div class="container"><nav class="nav-tabs"><button class="nav-tab" onclick="location.href='dashboard.html'">Dashboard</button><button class="nav-tab" onclick="location.href='orders.html'">Bestellungen</button><button class="nav-tab" onclick="location.href='products.html'">Produkte</button><button class="nav-tab active">Meldungen</button><button class="nav-tab" onclick="location.href='settings.html'">Einstellungen</button></nav></div>
<main class="container"><div class="card"><h3>Problem-Meldungen</h3><table><thead><tr><th>Beschreibung</th><th>Loch</th><th>Melder</th><th>Status</th><th>Zeit</th><th>Aktionen</th></tr></thead><tbody id="tbody"><tr><td colspan="6">Lade...</td></tr></tbody></table></div></main>
<script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js"></script>
<script>firebase.initializeApp({apiKey:"AIzaSyCDEWPkL9wEQ7C_as-GM74d0u8KbLYm47w",authDomain:"fairwayservice-768e9.firebaseapp.com",projectId:"fairwayservice-768e9",storageBucket:"fairwayservice-768e9.firebasestorage.app",messagingSenderId:"621650445863",appId:"1:621650445863:web:303dde082c00db6a867002"});const auth=firebase.auth(),db=firebase.firestore(),clubId=localStorage.getItem('adminClubId');auth.onAuthStateChanged(u=>{if(!u||!clubId)location.href='index.html';else{document.getElementById('userEmail').textContent=u.email;load();}});document.getElementById('logoutBtn').onclick=async()=>{await auth.signOut();localStorage.clear();location.href='index.html';};function load(){db.collection('clubs').doc(clubId).collection('issues').orderBy('createdAt','desc').onSnapshot(s=>{const tbody=document.getElementById('tbody');if(!s.size){tbody.innerHTML='<tr><td colspan="6" style="text-align:center;padding:40px;">Keine Meldungen</td></tr>';return;}tbody.innerHTML=s.docs.map(d=>{const i=d.data();const time=i.createdAt?.toDate().toLocaleString('de-DE',{day:'2-digit',month:'2-digit',hour:'2-digit',minute:'2-digit'})||'-';const badges={open:'<span class="badge badge-warning">Offen</span>',in_progress:'<span class="badge badge-info">In Bearbeitung</span>',resolved:'<span class="badge badge-success">Erledigt</span>'};return `<tr><td>${i.description||'-'}</td><td>${i.holeNumber||'-'}</td><td>${i.userName||'Anonym'}</td><td>${badges[i.status]||i.status}</td><td>${time}</td><td><select class="form-select" style="padding:6px;font-size:13px;" onchange="updateStatus('${d.id}',this.value)"><option value="open" ${i.status==='open'?'selected':''}>Offen</option><option value="in_progress" ${i.status==='in_progress'?'selected':''}>In Bearbeitung</option><option value="resolved" ${i.status==='resolved'?'selected':''}>Erledigt</option></select></td></tr>`;}).join('');});}window.updateStatus=async(id,status)=>{try{await db.collection('clubs').doc(clubId).collection('issues').doc(id).update({status});}catch(e){alert('Fehler');}};</script>
</body>
</html>
